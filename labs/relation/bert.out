nohup: ignoring input
2020-11-18 00:08:45.765580: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
2020-11-18 00:08:47,149 - train_supervised_bert.py - INFO - running train_supervised_bert.py --pretrain_path /home/liujian/NLP/corpus/transformers/hfl-chinese-bert-wwm-ext --pooler entity --metric micro_f1 --dataset test-policy --compress_seq --loss dice --adv flb --batch_size 12 --lr 1e-5 --weight_decay 0 --warmup_step 0 --max_length 256 --max_epoch 20 --optimizer adam --use_sampler
2020-11-18 00:08:47,150 - train_supervised_bert.py - INFO - Arguments:
2020-11-18 00:08:47,150 - train_supervised_bert.py - INFO - pretrain_path: /home/liujian/NLP/corpus/transformers/hfl-chinese-bert-wwm-ext
2020-11-18 00:08:47,150 - train_supervised_bert.py - INFO - ckpt: test-policy_bert_entity_dice_flb
2020-11-18 00:08:47,150 - train_supervised_bert.py - INFO - pooler: entity
2020-11-18 00:08:47,150 - train_supervised_bert.py - INFO - only_test: False
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - mask_entity: False
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - use_sampler: True
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - embed_entity_type: False
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - adv: flb
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - loss: dice
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - metric: micro_f1
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - dataset: test-policy
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - train_file: /home/liujian/github/AIPolicy/input/benchmark/relation/test-policy/test-policy_train.txt
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - val_file: /home/liujian/github/AIPolicy/input/benchmark/relation/test-policy/test-policy_val.txt
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - test_file: /home/liujian/github/AIPolicy/input/benchmark/relation/test-policy/test-policy_test.txt
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - rel2id_file: /home/liujian/github/AIPolicy/input/benchmark/relation/test-policy/test-policy_rel2id.json
2020-11-18 00:08:47,151 - train_supervised_bert.py - INFO - compress_seq: True
2020-11-18 00:08:47,152 - train_supervised_bert.py - INFO - batch_size: 12
2020-11-18 00:08:47,152 - train_supervised_bert.py - INFO - lr: 1e-05
2020-11-18 00:08:47,152 - train_supervised_bert.py - INFO - optimizer: adam
2020-11-18 00:08:47,152 - train_supervised_bert.py - INFO - weight_decay: 0.0
2020-11-18 00:08:47,152 - train_supervised_bert.py - INFO - warmup_step: 0
2020-11-18 00:08:47,152 - train_supervised_bert.py - INFO - max_length: 256
2020-11-18 00:08:47,152 - train_supervised_bert.py - INFO - max_epoch: 20
2020-11-18 00:08:47,152 - root - INFO - Loading BERT pre-trained checkpoint.
2020-11-18 00:08:51,647 - root - INFO - we have added 3 tokens ['“', '”', '—']
2020-11-18 00:09:09,042 - root - INFO - Loaded sentence RE dataset /home/liujian/github/AIPolicy/input/benchmark/relation/test-policy/test-policy_train.txt with 10508 lines and 13 relations.
2020-11-18 00:09:14,444 - root - INFO - Loaded sentence RE dataset /home/liujian/github/AIPolicy/input/benchmark/relation/test-policy/test-policy_val.txt with 3505 lines and 13 relations.
2020-11-18 00:09:20,139 - root - INFO - Loaded sentence RE dataset /home/liujian/github/AIPolicy/input/benchmark/relation/test-policy/test-policy_test.txt with 3509 lines and 13 relations.
2020-11-18 00:09:23,256 - train_supervised_bert.py - INFO - === Epoch 0 train ===
2020-11-18 00:10:19,190 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 20, loss: 2.4510, acc: 0.1792, micro_p: 0.0492, micro_r: 0.0874, micro_f1: 0.0629
2020-11-18 00:11:11,973 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 40, loss: 2.4709, acc: 0.1500, micro_p: 0.0476, micro_r: 0.0811, micro_f1: 0.0600
2020-11-18 00:12:08,753 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 60, loss: 2.4732, acc: 0.1528, micro_p: 0.0481, micro_r: 0.0811, micro_f1: 0.0604
2020-11-18 00:13:05,170 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 80, loss: 2.4746, acc: 0.1479, micro_p: 0.0425, micro_r: 0.0748, micro_f1: 0.0542
2020-11-18 00:13:59,098 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 100, loss: 2.4749, acc: 0.1517, micro_p: 0.0393, micro_r: 0.0702, micro_f1: 0.0504
2020-11-18 00:14:56,301 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 120, loss: 2.4738, acc: 0.1549, micro_p: 0.0426, micro_r: 0.0749, micro_f1: 0.0543
2020-11-18 00:15:52,879 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 140, loss: 2.4774, acc: 0.1476, micro_p: 0.0431, micro_r: 0.0748, micro_f1: 0.0547
2020-11-18 00:16:43,209 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 160, loss: 2.4759, acc: 0.1490, micro_p: 0.0440, micro_r: 0.0771, micro_f1: 0.0560
2020-11-18 00:17:34,816 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 180, loss: 2.4788, acc: 0.1477, micro_p: 0.0450, micro_r: 0.0775, micro_f1: 0.0569
2020-11-18 00:18:33,085 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 200, loss: 2.4797, acc: 0.1458, micro_p: 0.0458, micro_r: 0.0775, micro_f1: 0.0576
2020-11-18 00:19:28,990 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 220, loss: 2.4793, acc: 0.1500, micro_p: 0.0462, micro_r: 0.0781, micro_f1: 0.0581
2020-11-18 00:20:31,479 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 240, loss: 2.4791, acc: 0.1462, micro_p: 0.0439, micro_r: 0.0738, micro_f1: 0.0550
2020-11-18 00:21:25,458 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 260, loss: 2.4783, acc: 0.1478, micro_p: 0.0455, micro_r: 0.0762, micro_f1: 0.0570
2020-11-18 00:22:19,817 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 280, loss: 2.4809, acc: 0.1458, micro_p: 0.0459, micro_r: 0.0767, micro_f1: 0.0574
2020-11-18 00:23:14,947 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 300, loss: 2.4793, acc: 0.1472, micro_p: 0.0460, micro_r: 0.0771, micro_f1: 0.0576
2020-11-18 00:24:08,049 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 320, loss: 2.4785, acc: 0.1474, micro_p: 0.0461, micro_r: 0.0774, micro_f1: 0.0578
2020-11-18 00:25:04,680 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 340, loss: 2.4789, acc: 0.1475, micro_p: 0.0472, micro_r: 0.0783, micro_f1: 0.0589
2020-11-18 00:26:01,566 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 360, loss: 2.4803, acc: 0.1475, micro_p: 0.0480, micro_r: 0.0799, micro_f1: 0.0600
2020-11-18 00:26:46,342 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 380, loss: 2.4819, acc: 0.1454, micro_p: 0.0474, micro_r: 0.0782, micro_f1: 0.0590
2020-11-18 00:27:42,866 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 400, loss: 2.4834, acc: 0.1435, micro_p: 0.0476, micro_r: 0.0781, micro_f1: 0.0592
2020-11-18 00:28:33,835 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 420, loss: 2.4823, acc: 0.1435, micro_p: 0.0472, micro_r: 0.0773, micro_f1: 0.0586
2020-11-18 00:29:22,449 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 440, loss: 2.4832, acc: 0.1428, micro_p: 0.0473, micro_r: 0.0775, micro_f1: 0.0587
2020-11-18 00:30:15,625 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 460, loss: 2.4828, acc: 0.1433, micro_p: 0.0482, micro_r: 0.0791, micro_f1: 0.0599
2020-11-18 00:31:13,311 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 480, loss: 2.4816, acc: 0.1431, micro_p: 0.0483, micro_r: 0.0796, micro_f1: 0.0601
2020-11-18 00:32:10,044 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 500, loss: 2.4822, acc: 0.1417, micro_p: 0.0479, micro_r: 0.0786, micro_f1: 0.0595
2020-11-18 00:33:04,899 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 520, loss: 2.4813, acc: 0.1409, micro_p: 0.0470, micro_r: 0.0776, micro_f1: 0.0585
2020-11-18 00:34:00,464 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 540, loss: 2.4809, acc: 0.1417, micro_p: 0.0467, micro_r: 0.0769, micro_f1: 0.0581
2020-11-18 00:34:53,029 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 560, loss: 2.4806, acc: 0.1412, micro_p: 0.0468, micro_r: 0.0767, micro_f1: 0.0581
2020-11-18 00:35:49,971 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 580, loss: 2.4803, acc: 0.1427, micro_p: 0.0467, micro_r: 0.0768, micro_f1: 0.0581
2020-11-18 00:36:47,421 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 600, loss: 2.4803, acc: 0.1432, micro_p: 0.0476, micro_r: 0.0781, micro_f1: 0.0591
2020-11-18 00:37:40,178 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 620, loss: 2.4807, acc: 0.1422, micro_p: 0.0470, micro_r: 0.0776, micro_f1: 0.0585
2020-11-18 00:38:28,650 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 640, loss: 2.4810, acc: 0.1418, micro_p: 0.0465, micro_r: 0.0764, micro_f1: 0.0579
2020-11-18 00:39:23,922 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 660, loss: 2.4802, acc: 0.1422, micro_p: 0.0468, micro_r: 0.0773, micro_f1: 0.0583
2020-11-18 00:40:17,055 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 680, loss: 2.4799, acc: 0.1429, micro_p: 0.0466, micro_r: 0.0769, micro_f1: 0.0580
2020-11-18 00:41:13,776 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 700, loss: 2.4799, acc: 0.1423, micro_p: 0.0469, micro_r: 0.0773, micro_f1: 0.0584
2020-11-18 00:42:10,636 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 720, loss: 2.4803, acc: 0.1412, micro_p: 0.0461, micro_r: 0.0762, micro_f1: 0.0574
2020-11-18 00:43:05,540 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 740, loss: 2.4798, acc: 0.1422, micro_p: 0.0463, micro_r: 0.0765, micro_f1: 0.0577
2020-11-18 00:44:01,497 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 760, loss: 2.4799, acc: 0.1429, micro_p: 0.0469, micro_r: 0.0775, micro_f1: 0.0584
2020-11-18 00:45:02,057 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 780, loss: 2.4797, acc: 0.1422, micro_p: 0.0464, micro_r: 0.0767, micro_f1: 0.0579
2020-11-18 00:45:54,534 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 800, loss: 2.4800, acc: 0.1426, micro_p: 0.0465, micro_r: 0.0767, micro_f1: 0.0579
2020-11-18 00:46:47,387 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 820, loss: 2.4807, acc: 0.1417, micro_p: 0.0461, micro_r: 0.0759, micro_f1: 0.0574
2020-11-18 00:47:36,196 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 840, loss: 2.4806, acc: 0.1431, micro_p: 0.0467, micro_r: 0.0767, micro_f1: 0.0580
2020-11-18 00:48:38,114 - train_supervised_bert.py - INFO - Training...Epoches: 0, steps: 860, loss: 2.4804, acc: 0.1441, micro_p: 0.0463, micro_r: 0.0761, micro_f1: 0.0576
2020-11-18 00:49:21,449 - train_supervised_bert.py - INFO - === Epoch 0 val ===
2020-11-18 00:49:33,312 - train_supervised_bert.py - INFO - Evaluation...Batches: 20, val_acc: 0.2917
2020-11-18 00:49:52,017 - train_supervised_bert.py - INFO - Evaluation...Batches: 40, val_acc: 0.2771
2020-11-18 00:50:10,900 - train_supervised_bert.py - INFO - Evaluation...Batches: 60, val_acc: 0.2694
2020-11-18 00:50:29,766 - train_supervised_bert.py - INFO - Evaluation...Batches: 80, val_acc: 0.2656
2020-11-18 00:50:48,839 - train_supervised_bert.py - INFO - Evaluation...Batches: 100, val_acc: 0.2650
2020-11-18 00:51:07,391 - train_supervised_bert.py - INFO - Evaluation...Batches: 120, val_acc: 0.2653
2020-11-18 00:51:26,154 - train_supervised_bert.py - INFO - Evaluation...Batches: 140, val_acc: 0.2649
2020-11-18 00:51:44,740 - train_supervised_bert.py - INFO - Evaluation...Batches: 160, val_acc: 0.2589
2020-11-18 00:52:03,269 - train_supervised_bert.py - INFO - Evaluation...Batches: 180, val_acc: 0.2569
2020-11-18 00:52:22,050 - train_supervised_bert.py - INFO - Evaluation...Batches: 200, val_acc: 0.2608
2020-11-18 00:52:40,413 - train_supervised_bert.py - INFO - Evaluation...Batches: 220, val_acc: 0.2625
2020-11-18 00:52:58,979 - train_supervised_bert.py - INFO - Evaluation...Batches: 240, val_acc: 0.2642
2020-11-18 00:53:17,555 - train_supervised_bert.py - INFO - Evaluation...Batches: 260, val_acc: 0.2647
2020-11-18 00:53:34,673 - train_supervised_bert.py - INFO - Evaluation...Batches: 280, val_acc: 0.2634
Traceback (most recent call last):
  File "train_supervised_bert.py", line 184, in <module>
    framework.train_model('micro_f1')
  File "../../pasaie/pasare/framework/sentence_re.py", line 206, in train_model
    result = self.eval_model(self.val_loader)
  File "../../pasaie/pasare/framework/sentence_re.py", line 247, in eval_model
    result = eval_loader.dataset.eval(pred_result)
  File "../../pasaie/pasare/framework/data_loader.py", line 123, in eval
    golden = self.rel2id[self.data[i]['relation']]
TypeError: list indices must be integers or slices, not str
